# ğŸ“± VISTA PREVIA - Pantalla AR en RUMBO

## RepresentaciÃ³n de la Interfaz

### Pantalla Principal de AR View

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â—€  AR VIEW                                      â“˜     â•‘  â† Barra Superior
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                        â•‘
â•‘             â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²                    â•‘
â•‘            â”‚                       â”‚                   â•‘
â•‘            â”‚     CUADRÃCULA AR     â”‚                   â•‘
â•‘            â”‚     (fondo oscuro)    â”‚                   â•‘
â•‘            â”‚                       â”‚                   â•‘
â•‘            â”‚   â—‰ (Bus cercano)     â”‚                   â•‘
â•‘            â”‚                       â”‚                   â•‘
â•‘            â”‚      â— (Bus mÃ¡s       â”‚                   â•‘
â•‘            â”‚         lejano)       â”‚                   â•‘
â•‘            â”‚                       â”‚                   â•‘
â•‘            â”‚                       â”‚                   â•‘
â•‘             â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±                    â•‘
â•‘                                                        â•‘
â•‘  AR VIEW ACTIVO                             âŠ™ BrÃºjula  â•‘
â•‘  UbicaciÃ³n: -16.3890, -71.5350            â”‚Nâ”‚          â•‘
â•‘  PrecisiÃ³n: 12.5m                         â”œâ”€â”¤          â•‘
â•‘  ğŸšŒ 3 autobuses cercanos                  â””â”€â”˜          â•‘
â•‘                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â•‘
â•‘  â”‚ Autobuses Cercanos                     â”‚           â•‘  â† Panel Lateral
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â•‘
â•‘  â”‚ Bus 12                                  â”‚           â•‘
â•‘  â”‚ Centro - Cercado                        â”‚           â•‘
â•‘  â”‚ 0.25 km                     35 km/h     â”‚           â•‘
â•‘  â”‚                                         â”‚           â•‘
â•‘  â”‚ Bus 5                                   â”‚           â•‘
â•‘  â”‚ Yanahuara - Cercado                     â”‚           â•‘
â•‘  â”‚ 0.35 km                     28 km/h     â”‚           â•‘
â•‘  â”‚                                         â”‚           â•‘
â•‘  â”‚ Bus 8                                   â”‚           â•‘
â•‘  â”‚ Jacobo - Cercado                        â”‚           â•‘
â•‘  â”‚ 0.50 km                     40 km/h     â”‚           â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â•‘
â•‘                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Marcador de Bus - Detalle

```
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
                    â•‘  â”‚    ğŸšŒ    â”‚  â•‘  Ãcono animado
                    â•‘  â”‚  35km/h  â”‚  â•‘  con gradiente
                    â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
                    â•‘                 â•‘
                    â•‘  Bus 12         â•‘  InformaciÃ³n
                    â•‘  Centro-Cercado â•‘  del autobÃºs
                    â•‘  0.25 km        â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## BrÃºjula - Detalle

```
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘      N (rojo)   â•‘
            â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
            â•‘    â”‚  â—€ â”‚ â–¶  â”‚  â•‘
            â•‘  O â”‚    â—    â”‚E  â•‘  (Centro con aguja)
            â•‘    â”‚  â—€ â”‚ â–¶  â”‚  â•‘
            â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
            â•‘      S (gris)   â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Panel HUD - Detalle

```
    â•”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AR VIEW          [ACTIVO]          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ UbicaciÃ³n: -16.3890, -71.5350      â”‚
    â”‚ PrecisiÃ³n: 12.5 m                  â”‚
    â”‚ ğŸšŒ 3 autobuses cercanos            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## AnimaciÃ³n de Entrada - Secuencia

```
Frame 1 (inicio):         Frame 2 (mitad):        Frame 3 (fin):
Escala 0.0                Escala 0.5              Escala 1.0

      â—‰                          â—‰                       â—‰â—‰â—‰
      
    (muy pequeÃ±o)          (mediano)              (tamaÃ±o final)

DuraciÃ³n: 500ms
```

## InteracciÃ³n del Usuario

```
Usuario abre app
       â†“
Presiona botÃ³n "Vista AR"
       â†“
Pantalla de carga (CircularProgressIndicator)
       â†“
Solicita permisos de ubicaciÃ³n
       â†“
Usuario acepta
       â†“
Vista AR aparece con animaciÃ³n
       â†“
CuadrÃ­cula aparece
       â†“
Autobuses se animan (ScaleTransition)
       â†“
InformaciÃ³n se actualiza en tiempo real
       â†“
Usuario puede girar dispositivo para explorar
```

## Flujo de Posicionamiento

```
Centro de pantalla (usuario)
         âŠ™
        /|\  bearing = 45Â°
       / | \
      /  |  \
     /   |   \  distancia = 250m
    /    |    \
   /     |     \
  â—‰ â† Bus posicionado en AR
     (en relaciÃ³n a usuario)

CÃ¡lculo:
  angle = bearing * Ï€ / 180
  offsetX = distancia * sin(angle)
  offsetY = -distancia * cos(angle)
  screenX = centerX + offsetX
  screenY = centerY + offsetY
```

## Estados de la AplicaciÃ³n

```
ARViewInitial
  â†“ (usuario abre)
ARViewLoading (solicitando permisos)
  â†“
  â”œâ”€ ERROR â†’ ARViewError (permisos denegados)
  â”‚
  â””â”€ OK â†’ ARViewReady
            â”œâ”€ userLocation: ARUserLocation?
            â””â”€ nearbyBuses: List<ARBusMarker>
               â†“ (se actualiza continuamente)
            ARViewReady (nuevos valores)
            ARViewReady (nuevos valores)
            ...
  â†“ (usuario cierra)
ARViewInitial
```

## Colores Utilizados

```
â•”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•
â”‚ CYAN          #00BCD4 (Primario)    â”‚
â”‚ BLUE          #2196F3 (Secundario)  â”‚
â”‚ LIGHT_BLUE    #81D4FA (Acentos)     â”‚
â”‚ GREEN         #4CAF50 (Ã‰xito)       â”‚
â”‚ RED           #F44336 (Error)       â”‚
â”‚ ORANGE        #FF9800 (Advertencia) â”‚
â”‚ BLACK         #000000 (Fondo)       â”‚
â”‚ WHITE         #FFFFFF (Texto)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Mapeo de Pantalla - Ejemplo Real

```
Datos del Bus:
  - Latitude: -16.3892 (usuario estÃ¡ en -16.3890)
  - Longitude: -71.5348 (usuario estÃ¡ en -71.5350)
  - Bearing: 45Â° (NE)
  - Distancia: 250 metros

Pantalla (500x800 px):
  - Centro X: 250
  - Centro Y: 400

CÃ¡lculos:
  angle = 45 * Ï€/180 = 0.785 rad
  screenDistance = (250/1000) * 250 = 62.5 px
  offsetX = 62.5 * sin(0.785) = 44.2 px
  offsetY = -62.5 * cos(0.785) = -44.2 px

PosiciÃ³n Final:
  screenX = 250 + 44.2 = 294.2
  screenY = 400 - 44.2 = 355.8

â†³ Bus aparece a 294.2, 355.8 en pantalla
```

## Timeline de ActualizaciÃ³n

```
T=0s    Usuario abre Vista AR
        â””â”€ Solicita permisos âœ“

T=0.5s  â”Œâ”€ ARViewReady (estado inicial)
        â”œâ”€ Inicializa streams
        â””â”€ Renderiza interfaz

T=1s    â”Œâ”€ UbicaciÃ³n: (-16.3890, -71.5350)
        â””â”€ Renderiza cuadrÃ­cula

T=1.5s  â”Œâ”€ Primer bus: Bus 12 a 250m
        â”œâ”€ Segundo bus: Bus 5 a 350m
        â””â”€ Tercer bus: Bus 8 a 500m

T=2s    â””â”€ Actualiza posiciones (stream de ubicaciÃ³n)

T=4s    â””â”€ Actualiza autobuses (stream de datos)

T=6s    â””â”€ Actualiza nuevamente

...     â””â”€ ContinÃºa en tiempo real hasta cerrar
```

## Ejemplo de RenderizaciÃ³n

```
Canvas Layer 1: CuadrÃ­cula
  â””â”€ CustomPaint(ARGridPainter)
     â””â”€ Dibuja lÃ­neas, cÃ­rculos de distancia

Canvas Layer 2: Centro
  â””â”€ CÃ­rculo verde pequeÃ±o
     â””â”€ Indica posiciÃ³n del usuario

Canvas Layer 3: Marcadores
  â””â”€ Stack de mÃºltiples Positioned
     â””â”€ Cada uno contiene un marcador animado

Canvas Layer 4: HUD
  â””â”€ Container en esquina superior
     â””â”€ Texto con informaciÃ³n

Canvas Layer 5: BrÃºjula
  â””â”€ Container en esquina inferior derecha
     â””â”€ CÃ­rculo con orientaciÃ³n
```

## Respuesta a Interacciones

```
Usuario toca:
  â†“
âŒ No hay toques manejados (solo lectura de sensor)

Usuario gira dispositivo:
  â†“
Heading se actualiza desde GPS
  â†“
BrÃºjula rota
  â†“
Posiciones de buses se recalculan
  â†“
Pantalla se actualiza en tiempo real

Usuario abre panel de informaciÃ³n:
  â†“
Dialog aparece con:
  - Instrucciones de uso
  - NÃºmero de autobuses
  - PrecisiÃ³n del GPS
  â†“
Usuario presiona "Cerrar"
  â†“
Dialog se cierra
```

---

Esta es la representaciÃ³n visual de la interfaz AR que se ha implementado en la aplicaciÃ³n RUMBO.
